<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Category Management - ZZRH</title>
    <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        .glass-effect {
            backdrop-filter: blur(10px);
            background: rgba(255, 255, 255, 0.95);
        }
        .gradient-bg {
            background: linear-gradient(135deg, #1f2937 0%, #000000 100%);
        }
        .hover-lift {
            transition: all 0.3s ease;
        }
        .hover-lift:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }
        .form-input:focus {
            transform: translateY(-1px);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <% if(error) {%>
        <script>
        Swal.fire({
                toast: true,
                icon: 'error',
                title: '<%=error%>',
                position: 'top-right',
                showConfirmButton: false,
                timer: 3000
            });
        </script>
    <% } %>

    <!-- Top Navigation -->
    <nav class="glass-effect border-b border-white/20 shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex justify-between items-center">
                <div class="flex items-center space-x-4">
                    <div class="w-10 h-10 gradient-bg rounded-xl flex items-center justify-center text-white font-bold">
                        Z
                    </div>
                    <h1 class="text-2xl font-bold bg-gradient-to-r from-gray-800 to-black bg-clip-text text-transparent">#ZZRH</h1>
                </div>
                <button class="relative p-3 hover:bg-white/50 rounded-xl transition-all">
                    <i class="far fa-bell text-xl text-gray-700"></i>
                    <span class="absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full"></span>
                </button>
            </div>
        </div>
    </nav>

    <div class="flex min-h-screen">
        <!-- Sidebar -->
        <%- include('../Partials/sidebar') %>

        <!-- Main Content -->
        <main class="flex-1 p-8">
            <!-- Back Link -->
            <a href="/admin/category" class="inline-flex items-center gap-2 text-gray-700 hover:text-black mb-8 font-medium transition-all group">
                <div class="w-8 h-8 rounded-lg bg-gray-100 flex items-center justify-center group-hover:bg-black group-hover:text-white transition-all">
                    <i class="fas fa-arrow-left text-sm"></i>
                </div>
                <span>Back to Category Management</span>
            </a>

            <!-- Page Header -->
            <div class="mb-10">
                <h1 class="text-4xl font-bold text-gray-900 mb-3">Edit Category</h1>
                <p class="text-gray-600 text-lg">Update category information and settings</p>
            </div>

            <!-- Form Card -->
            <div class="max-w-3xl">
                <div class="glass-effect rounded-2xl shadow-xl p-8 border border-white/20">
                    <form id="categoryForm" >
                        <input type="hidden" id="categoryId" value="<%= id %>">
                        <!-- Category Name -->
                        <div class="mb-8">
                            <label class="flex items-center gap-2 text-gray-900 font-semibold mb-3 text-lg">
                                <i class="fas fa-tag text-gray-600"></i>
                                <span>Category Name</span>
                            </label>
                            <input 
                                id="category_name"
                                name="category_name"
                                type="text" 
                                placeholder="e.g., Men / Women / Kids" 
                                value="<%= name %>"
                                class="form-input w-full px-5 py-4 bg-white border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent transition-all text-gray-900"
                            >
                            <span id="category-error" class="text-xs text-red-500 mt-2 block"></span>
                        </div>

                        <!-- Description -->
                        <div class="mb-8">
                            <label class="flex items-center gap-2 text-gray-900 font-semibold mb-3 text-lg">
                                <i class="fas fa-align-left text-gray-600"></i>
                                <span>Description</span>
                            </label>
                            <textarea 
                                id="description"
                                name="description"
                                placeholder="Provide a detailed description of this category..." 
                                rows="6" 
                                class="form-input w-full px-5 py-4 bg-white border-2 border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-gray-500 focus:border-transparent resize-none transition-all text-gray-900"
                            ><%= description %></textarea>
                            <span id="description-error" class="text-xs text-red-500 mt-2 block"></span>
                        </div>

                        <!-- Status -->
                        <div class="mb-10">
                            <label class="flex items-center gap-2 text-gray-900 font-semibold mb-4 text-lg">
                                <i class="fas fa-toggle-on text-gray-600"></i>
                                <span>Status</span>
                            </label>
                            <div class="flex gap-4">
                                <button 
                                    id="inactive"
                                    onclick="set_status(false)"
                                    type="button" 
                                    class="button flex-1 px-6 py-4 border-2 border-gray-300 rounded-xl text-gray-700 hover:bg-gray-50 transition-all font-medium flex items-center justify-center gap-2 <%= status === false 
          ? 'gradient-bg text-white border-gray-500 shadow-lg' 
          : 'border-gray-300 text-gray-700 hover:bg-gray-50' %>"
                                >
                                    <i class="fas fa-times-circle"></i>
                                    <span>Inactive</span>
                                </button>
                                <button 
                                    id="active"
                                    onclick="set_status(true)"
                                    type="button" 
                                    class="button flex-1 px-6 py-4 border-2 border-gray-300 rounded-xl text-gray-700 hover:bg-gray-50 transition-all font-medium flex items-center justify-center gap-2 <%= status === true 
          ? 'gradient-bg text-white border-gray-500 shadow-lg' 
          : 'border-gray-300 text-gray-700 hover:bg-gray-50' %>"
                                >
                                    <i class="fas fa-check-circle"></i>
                                    <span>Active</span>
                                </button>
                            </div>
                            <input type="hidden" name="status" id="status_Input">
                            <span id="status-error" class="text-xs text-red-500 mt-2 block"></span>
                        </div>

                        <!-- Action Buttons -->
                        <div class="flex justify-end gap-4 pt-6 border-t border-gray-200">
                            <a href="/admin/category">
                                <button 
                                    type="button" 
                                    class="px-8 py-3 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-xl transition-all font-medium"
                                >
                                    Cancel
                                </button>
                            </a>
                            <button 
                                type="submit" 
                                class="px-8 py-3 gradient-bg text-white rounded-xl hover-lift font-medium shadow-lg flex items-center gap-2"
                            >
                                <i class="fas fa-save"></i>
                                <span>Update Category</span>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </main>
    </div>

    <script>
        (function(){
            const categoryForm = document.getElementById('categoryForm')
            const fields = {
                name:document.getElementById('category_name'),
                description:document.getElementById('description'),
                status:document.getElementById('status_Input')
            }
            const errors = {
                name:document.getElementById('category-error'),
                description:document.getElementById('description-error'),
                status:document.getElementById('status-error')
            }
            function validateField(field){
                const value = fields[field].value.trim()
                switch (field){
                    case "name":
                        if (value.length < 3) {
                            errors.name.textContent = "Enter valid name"
                            return false
                        }
                        if(!/^[A-Za-z]+( [A-Za-z]+)*$/.test(value)){
                            errors.name.textContent = "Only characters accepted"
                            return false
                        }
                        errors.name.textContent = ""
                        return true
                    case "description":
                        if(value.length == 0){
                        errors.description.textContent = "Enter a valid description"
                        return false
                        }
                        if(value.length<5){
                        errors.description.textContent = "Please enter atleast 5 characters"
                        return false


                        }
                        if(value.length>300){
                        errors.description.textContent = "Sorry it cannot be too long...."
                        return false
                        }
                        if(!/^[A-Za-z]+([ '-][A-Za-z]+)*$/.test(value)){
                            errors.description.textContent = "Name can contain letters, spaces, hyphens (-), and apostrophes (') only"
                            return false
                        }
                        errors.description.textContent = ""
                        return true
                    case "status":
                        if(!value){
                            errors.status.textContent = "Enter status"
                            return false
                        }
                        errors.status.textContent = ""
                        return true
                        
                }
            }

             Object.keys(fields).forEach(field => {
                fields[field].addEventListener("input", () => validateField(field))
                fields[field].addEventListener("blur", () => validateField(field))
            })
            categoryForm.addEventListener("submit", async function (e) {
                e.preventDefault()
                let valid = true
                Object.keys(fields).forEach(field => {
                if (!validateField(field)) valid = false
                })
                if (!valid){
                    Swal.fire({
                        toast: true,
                        icon: 'error',
                        title: 'Please fix all validation errors',
                        position: 'top-right',
                        showConfirmButton: false,
                        timer: 3000
                    });
                    return;
                }
                const categoryId = document.getElementById('categoryId').value
                try{
                    const formData = new FormData(categoryForm)
                    const request = await fetch(`/admin/category-edit/${categoryId}`,{
                        method:"POST",
                        body:formData
                    }) 

                    const result = await request.json()

                    if(result.success){
                        
                        await Swal.fire({
                            icon: 'success',
                            title: 'Success!',
                            text: result.message || 'Category Edited successfully',
                            confirmButtonColor: '#ef4444',
                            confirmButtonText: 'View Category'
                        });
                        window.location.href = result.redirect;
                    }else {
                        Swal.fire({
                        toast: true,
                        icon: 'error',
                        title: result.message,
                        position: 'top-right',
                        showConfirmButton: false,
                        timer: 3000
                        });
                    }

                }catch(e){
                    console.log("Front end error : ",e)
                    Swal.fire({
                        toast: true,
                        icon: 'error',
                        title: e,
                        position: 'top-right',
                        showConfirmButton: false,
                        timer: 3000
                    });
                }
            })
        })()
        
        const statusButtons = document.querySelectorAll('.button');
        const statusGroup = Array.from(statusButtons).slice(-2);
        
        function set_status(msg){
            const status_Input = document.getElementById("status_Input")
            const active = document.getElementById('active')
            const inactive = document.getElementById('inactive')
            active.classList.remove('gradient-bg','text-white','border-gray-500','shadow-lg');
            inactive.classList.remove('gradient-bg', 'text-white','border-gray-500','shadow-lg');
            if(msg){
                active.classList.add('gradient-bg','text-white','border-gray-500','shadow-lg');
            }else{
                inactive.classList.add('gradient-bg', 'text-white','border-gray-500','shadow-lg');
            }
            status_Input.value = msg
        }
        
        statusGroup.forEach(button => {
            button.addEventListener('click', function() {
                statusGroup.forEach(btn => {
                    btn.classList.remove('gradient-bg', 'text-white', 'border-gray-500', 'shadow-lg');
                    btn.classList.add('border-gray-300', 'text-gray-700');
                });
                this.classList.remove('border-gray-300', 'text-gray-700');
                this.classList.add('gradient-bg', 'text-white', 'border-gray-500', 'shadow-lg');
            });
        });
    </script>
</body>
</html>